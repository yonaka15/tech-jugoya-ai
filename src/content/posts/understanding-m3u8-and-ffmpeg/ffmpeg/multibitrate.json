{
  "blocks": [
    {
      "id": "multibitrate-heading",
      "type": "heading",
      "props": {
        "content": "マルチビットレートストリーミング",
        "level": 2,
        "align": "left"
      }
    },
    {
      "id": "multibitrate-intro",
      "type": "text",
      "props": {
        "content": "マルチビットレートストリーミングは、視聴者の通信環境に応じて最適な品質の動画を提供するための重要な技術です。FFmpegを使用して、複数の品質のストリームを同時に生成する方法を解説します。",
        "align": "left"
      }
    },
    {
      "id": "multibitrate-flow",
      "type": "mermaid",
      "props": {
        "content": "graph TD\n    A[入力ファイル] -->|FFmpeg| B[マルチストリーム処理]\n    B --> C[1080p/4000k]\n    B --> D[720p/2500k]\n    B --> E[480p/1000k]\n    B --> F[360p/600k]\n    C --> G[master.m3u8]\n    D --> G\n    E --> G\n    F --> G\n    style A fill:#f9f,stroke:#333,stroke-width:2px\n    style G fill:#bfb,stroke:#333,stroke-width:2px",
        "caption": "マルチビットレートストリーミングの構造",
        "theme": "default"
      }
    },
    {
      "id": "multibitrate-example",
      "type": "code",
      "props": {
        "language": "bash",
        "code": "#!/bin/bash\n\n# 入力ファイルとベースとなる出力名を設定\nINPUT=\"input.mp4\"\nOUTPUT_HLS=\"stream\"\n\n# マルチビットレートHLSを生成\nffmpeg -i $INPUT \\\n  -filter_complex \"\n  # 1080p/4000k\n  [0:v]split=4[v1][v2][v3][v4];\n  [v1]scale=1920:1080[v1out];\n  # 720p/2500k\n  [v2]scale=1280:720[v2out];\n  # 480p/1000k\n  [v3]scale=842:480[v3out];\n  # 360p/600k\n  [v4]scale=640:360[v4out]\n  \" \\\n  -map '[v1out]' -c:v:0 libx264 -b:v:0 4000k \\\n  -map '[v2out]' -c:v:1 libx264 -b:v:1 2500k \\\n  -map '[v3out]' -c:v:2 libx264 -b:v:2 1000k \\\n  -map '[v4out]' -c:v:3 libx264 -b:v:3 600k \\\n  -map a:0 -c:a aac -b:a:0 128k -ac 2 \\\n  -map a:0 -c:a aac -b:a:1 96k -ac 2 \\\n  -map a:0 -c:a aac -b:a:2 48k -ac 2 \\\n  -map a:0 -c:a aac -b:a:3 32k -ac 2 \\\n  -f hls \\\n  -var_stream_map \"v:0,a:0 v:1,a:1 v:2,a:2 v:3,a:3\" \\\n  -master_pl_name ${OUTPUT_HLS}_master.m3u8 \\\n  -hls_segment_filename ${OUTPUT_HLS}_%v/data%03d.ts \\\n  -hls_playlist_type vod \\\n  -hls_time 6 \\\n  -hls_list_size 0 \\\n  ${OUTPUT_HLS}_%v.m3u8",
        "fileName": "create_multibitrate_hls.sh"
      }
    },
    {
      "id": "multibitrate-explanation",
      "type": "callout",
      "props": {
        "type": "info",
        "title": "マルチビットレート設定の解説",
        "content": "- **ストリームの品質設定**:\n  - 1080p: 4000kbps（高品質）\n  - 720p: 2500kbps（標準品質）\n  - 480p: 1000kbps（低品質）\n  - 360p: 600kbps（モバイル向け）\n\n- **音声品質設定**:\n  - 128kbps（高品質音声）\n  - 96kbps（標準品質）\n  - 48kbps（低品質）\n  - 32kbps（モバイル向け）\n\n- **セグメント設定**:\n  - 6秒のセグメント長\n  - VODタイプのプレイリスト\n  - 可変ストリームマッピング"
      }
    }
  ]
}